---
title: "Presentation Ninja"
subtitle: "&#x2694;&#xFE0F; xaringan +<br/>&#x1F60E; xaringanthemer"  
author: 
  - "Yihui Xie"
  - "Garrick Aden-Buie"
date: '`r Sys.Date()`'
output:
  xaringan::moon_reader:
    lib_dir: libs
    seal: false 
    css: xaringan-themer.css
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r setup, include=FALSE, cache=TRUE}
options(htmltools.dir.version = FALSE)
```

```{r xaringan-themer, include=FALSE, warning=FALSE}
library(xaringanthemer)
library(tidyverse)
library(kableExtra)
library(knitr)
library(lubridate)
library(plotly)
library(ggridges)
library(ggExtra)
library(patchwork)
style_duo_accent(
  primary_color = "#1381B0",
  secondary_color = "#FF961C",
  inverse_header_color = "#FFFFFF"
)
```

```{r read-data, warning=FALSE, message=FALSE, include=FALSE}
sensor_location <- read_csv("Microclimate_Sensor_Locations.csv")
sensor_readings <- read_csv("Microclimate_Sensor_Readings.csv")
```

```{r wrangling, warning=FALSE, message=FALSE, include=FALSE}
sensor_readings <- sensor_readings %>% 
  mutate(local_time = ymd_hms(local_time))
sensor_location <- sensor_location %>% 
  mutate(last_data = ymd_hms(last_data))

sensor_melb <- sensor_readings %>% 
  left_join(sensor_location, by=c("site_id"="site_id"))

air_quality <- sensor_melb %>%
  filter(sensor_id %in% c("0a.EPA-1h","0b.EPA-1h","0a.EPA-24h","0b.EPA-24h")) %>%
  mutate(condition= case_when(type %in% c("PM10-EPA-1h","PM10-EPA-24h","PM10") & value < 40 ~ "Good",
                              type %in% c("PM10-EPA-1h","PM10-EPA-24h","PM10") & between(value, 40,80) ~ "Moderate",
                              type %in% c("PM10-EPA-1h","PM10-EPA-24h","PM10") & between(value, 80,120) ~ "Poor",
                              type %in% c("PM10-EPA-1h","PM10-EPA-24h","PM10") & between(value, 120,240) ~ "Very Poor",
                              type %in% c("PM10-EPA-1h","PM10-EPA-24h","PM10") & value >= 120 ~ "Hazardous",
                              type %in% c("PM2.5-EPA-1h","PM2.5-EPA-24h","PM2.5") & value< 27 ~ "Good",
                              type %in% c("PM2.5-EPA-1h","PM2.5-EPA-24h","PM2.5") & between(value, 27,62) ~ "Moderate",
                              type %in% c("PM2.5-EPA-1h","PM2.5-EPA-24h","PM2.5") & between(value, 62,97) ~ "Poor",
                              type %in% c("PM2.5-EPA-1h","PM2.5-EPA-24h","PM2.5") & between(value, 97,370) ~ "Very Poor",
                              type %in% c("PM2.5-EPA-1h","PM2.5-EPA-24h","PM2.5") & value >= 370 ~ "Hazardous"),
         date = as_date(local_time),
         day = mday(local_time),
         time = hour(local_time),
         month = month(local_time,label = TRUE),
         year = year(local_time))


MyPalette <- c("#64A13C", "#EAC51C"  , "#D67900", "#A90737","#50051E")
names(MyPalette) <- unique(air_quality$condition)
```

```{r function-plot, warning=FALSE, message=FALSE, include=FALSE}
# MyPalette <- c("#5DD0B9","#E1E7E9", "#1f78b4", "#a6cee3", "#f86cc5")

library(scales)


plot_air_post_lockdown <- function(df, type_epa, date_measure){
    df %>%
    filter(type == type_epa,
           local_time > date_measure) %>%
    ggplot(aes(x=time, y=value, color=factor(condition, levels = c("Good","Moderate","Poor", "Very Poor", "Hazardous")), group=date))+
    geom_point()+
    # geom_col(position="dodge", width = 0.5) +
    facet_wrap(description ~ ., ncol=2,
    labeller = labeller(description = label_wrap_gen(40))) +
    theme_bw() +
    labs(x = "Date Time",
         color = "Air Condition")+
    # theme(legend.position = "bottom")+
    scale_color_manual(values = MyPalette)+
    ggtitle(paste(type_epa, "After Lockdown"))
  # scale_color_brewer(palette = "viridis")+
}

plot_air_pre_lockdown <- function(df, type_epa, date_measure){
    df %>%
    filter(type == type_epa,
           local_time < date_measure) %>%
    ggplot(aes(x=time, y=value, color=factor(condition, levels = c("Good","Moderate","Poor", "Very Poor", "Hazardous")), group=date))+
    geom_point()+
    # geom_col(position="dodge", width = 0.5) +
    facet_wrap(description ~ ., ncol=2,
    labeller = labeller(description = label_wrap_gen(40))) +
    theme_bw() +
    labs(x = "Date Time",
         color = "Air Condition")+
    # theme(legend.position = "bottom")+
    scale_color_manual(values = MyPalette) +
        ggtitle(paste(type_epa, "Before Lockdown"))
  # scale_color_brewer(palette = "viridis")+
}
```


background-image: url(https://1v1d1e1lmiki1lgcvx32p49h8fe-wpengine.netdna-ssl.com/wp-content/uploads/2019/07/1561962307-Melbourne-Skyline.jpg)

Image credit: [source](https://1v1d1e1lmiki1lgcvx32p49h8fe-wpengine.netdna-ssl.com/wp-content/uploads/2019/07/1561962307-Melbourne-Skyline.jpg)


---
class: center, middle

# Air Quality in Melbourne

### Lachlan Moody & Putu Saputra

---
class: inverse, center, middle

# How has the Melbourne lockdown(s) affected air pollution around the city?

---

# Dataset

The climate sensor data from Melbourne City Council. This data set contains measurements obtained from November 2019 up until now, on things like humidity, temperature, and air quality from different locations around the city.

--

Based on air quality categories on [EPA AirWatch](https://www.epa.vic.gov.au/for-community/monitoring-your-environment/about-epa-airwatch/calculate-air-quality-categories) we took PM2.5 and PM10 as the pollutant with unit measurement of $µg/m^3$

--

```{r echo=FALSE}
Pollutant <- c("PM10", "PM2.5")
Measurement <- c("µg/m^3","µg/m^3")
Good <- c("< 40","< 27")
Moderate <- c("40–80", "27–62")
Poor <- c("80-120","62-97")
VeryPoor <- c("120–240","97-370")
Hazardous <- c(" >= 240",">= 370")

table<- tibble(Pollutant,Measurement,Good,Moderate,Poor,VeryPoor,Hazardous)
names(table)[3] <- cell_spec(names(table)[3], background = "#64A13C", color = "#FFFFFF")
names(table)[4] <- cell_spec(names(table)[4], background = "#EAC51C", color = "#FFFFFF")
names(table)[5] <- cell_spec(names(table)[5], background = "#D67900", color = "#FFFFFF")
names(table)[6] <- cell_spec(names(table)[6], background = "#A90737", color = "#FFFFFF")
names(table)[7] <- cell_spec(names(table)[7], background = "#50051E", color = "#FFFFFF")
table %>% kable(escape = FALSE)

```

---

# Air Pollution Distribution

.pull-left[
```{r density-all-type, out.width="100%", warning=FALSE, message=FALSE, echo=FALSE}
  air_quality %>%
# filter(  type=="PM2.5-EPA-1h") %>%
  mutate(lockdown= case_when(date < "2020-03-28" ~ "Before Lockdown",
                             date >= "2020-03-28" ~ "After Lockdown")) %>%
  ggplot(aes(x = value,
             y = type)) +
  geom_density_ridges(fill = "darkcyan",
                      alpha = 0.2) + 
  xlim(20, 250) +
  xlab("Value") +
  ylab("Categories of air pollution") +
  ggtitle("The Distribution of air pollution",
          subtitle = "The distributions are negatively skewed") +
  facet_wrap(~lockdown, ncol=1)+
  theme_bw()
```
]

.pull-right[
.item[
* Both of the plots are right skewed.
* Before the lockdown distribution of air quality tends to have more bigger values
* After lockdown have smaller.
]
]

---

# Hourly Plot based on PM2.5

```{r plot-hourly, echo=FALSE}
p1 <- plot_air_post_lockdown(air_quality, type_epa = "PM2.5-EPA-1h",date_measure = "2020-03-28 00:00:00")
p2 <- plot_air_post_lockdown(air_quality, type_epa = "PM10-EPA-1h",date_measure = "2020-03-28 00:00:00")
p3 <- plot_air_pre_lockdown(air_quality, type_epa = "PM2.5-EPA-1h",date_measure = "2020-03-28 00:00:00")
p4 <- plot_air_pre_lockdown(air_quality, type_epa = "PM10-EPA-1h",date_measure = "2020-03-28 00:00:00")
```

```{r, echo=FALSE, fig.width=10, fig.height=4}
p3|p1 + plot_layout(guides="collect") 
```

.item[
* Before the lockdown, the air quality looks bad with a lot of poor and hazardous categories
* A lot of pollutant happen in early hour, it can be activity from the industry or vehicles
* Air quality becomes much better after restriction occurs
]

---

# Hourly Plot based on PM10

```{r, echo=FALSE, fig.width=10, fig.height=4}
p4|p2 + plot_layout(guides="collect") 
```

.item[
* Before the lockdown, the air quality looks bad with a lot of poor and hazardous categories
* A lot of pollutant happen in early hour, it can be activity from the industry or vehicles
* Air quality becomes much better after restriction occurs
]

---

# Air Quality Daily in 2020
.pull-left[
```{r air-quality-daily, echo=FALSE}
air_quality %>%
  filter(type == "PM2.5-EPA-24h",
         year== 2020) %>%
  ggplot(aes(x = month, y = day, fill = condition)) +
  geom_tile(color = "white", size = 0.1) +
  scale_fill_manual(values = MyPalette)+
  # scale_fill_viridis(name = "Hourly Air Condition", option = "C") +
  # facet_grid(~ month) +
  # scale_x_continuous(trans = "reverse", breaks = unique(air_quality$time)) +
  scale_y_continuous(breaks = c(1, 10, 20, 31)) +
  theme_minimal(base_size = 7) +
  labs(
    title = "Hourly Air Condition PM2.5-EPA-24h",
    y = "Day",
    x="Month"
  ) +
  theme(
    legend.position = "bottom",
    # plot.title = element_text(size = 14),
    axis.text.y = element_text(size = 6),
    strip.background = element_rect(colour = "white"),
    plot.title = element_text(hjust = 0),
    axis.ticks = element_blank(),
    axis.text = element_text(size = 7),
    legend.title = element_text(size = 8),
    legend.text = element_text(size = 6)
  ) +
  removeGrid()+
  facet_wrap(~description)
```
]

.pull-right[
.item[
* January has a lot of days with bad air quality
* February - October Melbourne mostly have good quality of air (restriction start at March 28th)
]
]

---
